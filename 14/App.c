/*********************************************************************************************************
* 模块名称: 
* 摘    要: 
* 当前版本: 
* 作    者: 
* 完成日期:
* 内    容:
* 注    意:                                                                  
**********************************************************************************************************
* 取代版本: 
* 作    者:
* 完成日期: 
* 修改内容:
* 修改文件: 
*********************************************************************************************************/

/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include <stdio.h>
#include <windows.h>
#pragma comment(lib, "winmm.lib")

#include "PackUnpack.h"
#include "ProcMCUData.h"
#include "SendCmdToMCU.h"
/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/
static void InitSoftware(void);
static void __stdcall TimeProc(UINT uTimerID, UINT uMsg, DWORD_PTR dwUser,
                               DWORD_PTR dw1, DWORD_PTR dw2);
static void Proc2msTask(void);
static void Proc20msTask(void);
static void Proc1SecTask(void);
/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称: 
* 函数功能: 
* 输入参数: 
* 输出参数: 
* 返 回 值: 
* 创建日期: 
* 注    意: 
*********************************************************************************************************/
static void InitSoftware(void) {
    InitPackUnpack();
    InitProcMCUData();
    InitSendCmdToMCU();
}

/*********************************************************************************************************
* 函数名称:
* 函数功能:
* 输入参数:
* 输出参数:
* 返 回 值:
* 创建日期:
* 注    意:
*********************************************************************************************************/
static void __stdcall TimeProc(UINT uTimerID, UINT uMsg, DWORD_PTR dwUser,
                               DWORD_PTR dw1, DWORD_PTR dw2) {
    Proc2msTask();
}

/*********************************************************************************************************
* 函数名称:
* 函数功能:
* 输入参数:
* 输出参数:
* 返 回 值:
* 创建日期:
* 注    意:
*********************************************************************************************************/
static void Proc2msTask(void) {
    static i16 s_iCnt500 = 0;
    static i16 s_iCnt10 = 0;

    if(s_iCnt10 >= 9) {
        Proc20msTask();
        s_iCnt10 = 0;
    }
    else {
        s_iCnt10++;
    }

    if(s_iCnt500 >= 499) {
        Proc1SecTask();
        s_iCnt500 = 0;
    }
    else {
        s_iCnt500++;
    }
}

/*********************************************************************************************************
* 函数名称:
* 函数功能:
* 输入参数:
* 输出参数:
* 返 回 值:
* 创建日期:
* 注    意:
*********************************************************************************************************/
static void Proc20msTask(void) {
    static i16 s_iCnt = 0;

    static u8 s_arrRecMCUData[20] = {0x70, 0xa0, 0x82, 0x92, 0xb4, 0xd6, 0xf8, 0x90, 0x80, 0xb6,
                                     0x71, 0xa0, 0x82, 0x91, 0xb3, 0xd5, 0xf7, 0x99, 0x80, 0xbc};
    ProcMCUData(s_arrRecMCUData[s_iCnt]);

    if(s_iCnt >= 19) {
        s_iCnt = 0;
    }
    else {
        s_iCnt++;
    }
}

/*********************************************************************************************************
* 函数名称:
* 函数功能:
* 输入参数:
* 输出参数:
* 返 回 值:
* 创建日期:
* 注    意:
*********************************************************************************************************/
static void Proc1SecTask(void) {
    printf("Print gen wave1 cmd: ");
    SendGenWave1CmdToMCU();
    printf("\n");

    printf("Print gen wave2 cmd: ");
    SendGenWave2CmdToMCU();
    printf("\n");
}

/*********************************************************************************************************
*                                              API函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称: 
* 函数功能: 
* 输入参数: 
* 输出参数: 
* 返 回 值: 
* 创建日期: 
* 注    意: 
*********************************************************************************************************/
int main(void) {
    InitSoftware();

    timeSetEvent(2, 1, TimeProc, 0, TIME_PERIODIC);

    while(1) {

    }
}
